<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>File Upload</title>
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #121212;
        color: #f5f5f5;
        margin: 0;
        padding: 0;
    }
    h1 {
        text-align: center;
        color: #d4af37;
        margin-top: 30px;
        font-weight: 400;
    }
    .drop-zone {
        border: 2px dashed rgba(212, 175, 55, 0.5);
        padding: 30px;
        text-align: center;
        margin: 20px auto;
        width: 80%;
        max-width: 600px;
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.02);
        color: #ccc;
        transition: all 0.3s ease;
        box-shadow: 0 0 0px rgba(212, 175, 55, 0.5);
        cursor: pointer;
    }
    .drop-zone:hover {
        background: rgba(212, 175, 55, 0.05);
        border-color: #d4af37;
        transform: scale(1.02);
    }
    .dragover {
        border-color: #d4af37;
        background: rgba(212, 175, 55, 0.1);
        box-shadow: 0 0 25px rgba(212, 175, 55, 0.8);
    }
    @keyframes fadePop {
        0% { opacity: 0; transform: scale(0.9); }
        100% { opacity: 1; transform: scale(1); }
    }
    .file-block {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(212, 175, 55, 0.4);
        padding: 10px;
        margin: 10px;
        display: inline-block;
        position: relative;
        border-radius: 10px;
        color: #f5f5f5;
        min-width: 150px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        transition: transform 0.2s;
        animation: fadePop 0.4s ease-out;
        vertical-align: top;
    }
    .file-block:hover {
        transform: translateY(-3px);
    }
    .file-block img {
        max-width: 120px;
        max-height: 120px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        cursor: pointer;
        transition: transform 0.2s ease;
    }
    .file-block img:hover {
        transform: scale(1.05);
    }
    .reset-btn {
        position: absolute;
        top: 8px;
        right: 10px;
        cursor: pointer;
        color: #ff4d4d;
        font-size: 0.85rem;
        transition: color 0.2s;
    }
    .reset-btn:hover {
        color: #ff1a1a;
    }
    .global-btn {
        margin: 5px;
        padding: 10px 16px;
        border-radius: 25px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        color: #121212;
        background: linear-gradient(135deg, #d4af37, #b7950b);
        transition: background 0.3s, transform 0.2s;
    }
    .global-btn:hover {
        background: linear-gradient(135deg, #e6c76c, #d4af37);
        transform: translateY(-2px);
    }
    #image-buttons, #pdf-buttons {
        text-align: center;
        margin-bottom: 40px;
    }

    /* Lightbox styles */
    .lightbox {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: rgba(18, 18, 18, 0.95);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
    }
    .lightbox img {
        max-width: 90%;
        max-height: 80%;
        border: 4px solid #d4af37;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(212, 175, 55, 0.8);
    }
    .lightbox-close {
        position: absolute;
        top: 20px;
        right: 30px;
        font-size: 2rem;
        color: #d4af37;
        cursor: pointer;
    }
    .lightbox-close:hover {
        color: #fff;
    }
    .lightbox-controls {
        position: absolute;
        top: 50%;
        width: 100%;
        display: flex;
        justify-content: space-between;
        transform: translateY(-50%);
    }
    .lightbox-arrow {
        font-size: 3rem;
        color: #d4af37;
        cursor: pointer;
        padding: 0 20px;
        user-select: none;
    }
    .lightbox-arrow:hover {
        color: #fff;
    }
</style>
</head>
<body>

<h1>Image Upload</h1>
<div id="image-drop-zone" class="drop-zone">Drop images here or click to upload</div>
<input type="file" id="image-input" accept="image/*" multiple style="display:none;">
<div id="image-container">
    <p style="text-align:center;color:#aaa;width:100%;">Upload images to see previews here.</p>
</div>
<div id="image-buttons" style="display:none;">
    <button class="global-btn" id="reset-all-images">Reset All Images</button>
    <button class="global-btn" id="compress-all-images">Compress & Download All</button>
    <button class="global-btn" id="zip-all-images">Download All as ZIP</button>
</div>

<h1>PDF Upload</h1>
<div id="pdf-drop-zone" class="drop-zone">Drop PDFs here or click to upload</div>
<input type="file" id="pdf-input" accept="application/pdf" multiple style="display:none;">
<div id="pdf-container">
    <p style="text-align:center;color:#aaa;width:100%;">Upload PDFs to see previews here.</p>
</div>
<div id="pdf-buttons" style="display:none;">
    <button class="global-btn" id="reset-all-pdfs">Reset All PDFs</button>
    <button class="global-btn" id="compress-all-pdfs">Download All PDFs</button>
    <button class="global-btn" id="zip-all-pdfs">Download All as ZIP</button>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <span class="lightbox-close" id="lightbox-close">&times;</span>
    <div class="lightbox-controls">
        <span class="lightbox-arrow" id="lightbox-prev">&#10094;</span>
        <span class="lightbox-arrow" id="lightbox-next">&#10095;</span>
    </div>
    <img id="lightbox-img" src="">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
let imageFiles = [];
let pdfFiles = [];
let currentImageIndex = 0;

function setupDropZone(dropZoneId, inputId, containerId, fileType){
    const dropZone = document.getElementById(dropZoneId);
    const fileInput = document.getElementById(inputId);
    const container = document.getElementById(containerId);

    dropZone.addEventListener('click', ()=>fileInput.click());
    dropZone.addEventListener('dragover', e=>{
        e.preventDefault();
        dropZone.classList.add('dragover');
    });
    dropZone.addEventListener('dragleave', ()=>dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', e=>{
        e.preventDefault();
        dropZone.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', ()=>handleFiles(fileInput.files));

    function handleFiles(files){
        if(container.querySelector('p')) container.innerHTML='';

        if(fileType === 'image'){ document.getElementById('image-buttons').style.display = 'block'; }
        if(fileType === 'pdf'){ document.getElementById('pdf-buttons').style.display = 'block'; }

        Array.from(files).forEach(file=>{
            if(fileType === 'pdf' && file.size > 100*1024*1024){
                alert(`PDF "${file.name}" exceeds 100MB limit`);
                return;
            }
            createFileBlock(file, container, containerId, fileType);
        });
    }
}

function createFileBlock(file, container, containerId, fileType){
    const block = document.createElement('div');
    block.className = 'file-block';

    const resetBtn = document.createElement('span');
    resetBtn.className='reset-btn';
    resetBtn.textContent='âœ–';
    resetBtn.addEventListener('click', ()=>{
        block.remove();
        if(fileType === 'image'){ 
            imageFiles = imageFiles.filter(f => f.file !== file);
        }
        if(fileType === 'pdf'){ 
            pdfFiles = pdfFiles.filter(f => f !== file); 
        }
        checkIfContainerEmpty(containerId, fileType);
    });

    block.appendChild(resetBtn);

    if(fileType === 'image'){
        const reader = new FileReader();
        reader.onload = e => {
            const imgEl = document.createElement('img');
            imgEl.src = e.target.result;
            imgEl.addEventListener('click', ()=>{
                currentImageIndex = imageFiles.findIndex(f => f.file === file);
                openLightbox(currentImageIndex);
            });
            block.insertBefore(imgEl, resetBtn.nextSibling);
            const nameEl = document.createElement('div');
            nameEl.textContent = file.name;
            nameEl.style.fontSize = '0.85rem';
            nameEl.style.marginTop = '5px';
            block.appendChild(nameEl);
            imageFiles.push({file, src: e.target.result});
        };
        reader.readAsDataURL(file);
    } else {
        const pdfIcon = document.createElement('div');
        pdfIcon.innerHTML = "ðŸ“„";
        pdfIcon.style.fontSize = '50px';
        pdfIcon.style.marginBottom = '8px';
        block.appendChild(pdfIcon);
        const nameEl = document.createElement('div');
        nameEl.textContent = file.name;
        nameEl.style.fontSize = '0.85rem';
        block.appendChild(nameEl);
        pdfFiles.push(file);
    }

    container.appendChild(block);
}

function checkIfContainerEmpty(containerId, fileType){
    const container = document.getElementById(containerId);
    if(container.querySelectorAll('.file-block').length === 0){
        container.innerHTML = `<p style="text-align:center;color:#aaa;width:100%;">Upload ${fileType}s to see previews here.</p>`;
        if(fileType === 'image'){ document.getElementById('image-buttons').style.display = 'none'; }
        if(fileType === 'pdf'){ document.getElementById('pdf-buttons').style.display = 'none'; }
    }
}

function resetAllFiles(containerSelector, buttonsContainerId, fileType){
    const container = document.querySelector(containerSelector);
    container.innerHTML = `<p style="text-align:center;color:#aaa;width:100%;">Upload ${fileType}s to see previews here.</p>`;
    document.getElementById(buttonsContainerId).style.display = 'none';
    if(fileType === 'image'){ imageFiles = []; }
    if(fileType === 'pdf'){ pdfFiles = []; }
}

document.getElementById('compress-all-images').addEventListener('click', async ()=>{
    for(const {file} of imageFiles){
        const img = await loadImage(file);
        const compressedBlob = await compressImage(img, 0.7);
        saveAs(compressedBlob, file.name.replace(/\.(\w+)$/, '_compressed.$1'));
    }
});

document.getElementById('compress-all-pdfs').addEventListener('click', ()=>{
    pdfFiles.forEach(file => saveAs(file, file.name));
});

async function downloadAllAsZip(files, zipName){
    const zip = new JSZip();
    for(const f of files){
        zip.file(f.file ? f.file.name : f.name, f.file || f);
    }
    const content = await zip.generateAsync({type:"blob"});
    saveAs(content, zipName);
}

document.getElementById('zip-all-images').addEventListener('click', ()=>downloadAllAsZip(imageFiles, 'images.zip'));
document.getElementById('zip-all-pdfs').addEventListener('click', ()=>downloadAllAsZip(pdfFiles, 'pdfs.zip'));

function loadImage(file){
    return new Promise((resolve, reject)=>{
        const reader = new FileReader();
        reader.onload = e=>{
            const img = new Image();
            img.onload = ()=>resolve(img);
            img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

function compressImage(img, quality){
    return new Promise(resolve=>{
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        canvas.toBlob(blob => resolve(blob), 'image/jpeg', quality);
    });
}

// Lightbox with navigation
function openLightbox(index) {
    document.getElementById('lightbox-img').src = imageFiles[index].src;
    document.getElementById('lightbox').style.display = 'flex';
}

function showPrevImage() {
    currentImageIndex = (currentImageIndex - 1 + imageFiles.length) % imageFiles.length;
    openLightbox(currentImageIndex);
}

function showNextImage() {
    currentImageIndex = (currentImageIndex + 1) % imageFiles.length;
    openLightbox(currentImageIndex);
}

document.getElementById('lightbox-prev').addEventListener('click', showPrevImage);
document.getElementById('lightbox-next').addEventListener('click', showNextImage);

document.getElementById('lightbox-close').addEventListener('click', ()=>{
    document.getElementById('lightbox').style.display = 'none';
});
document.getElementById('lightbox').addEventListener('click', (e)=>{
    if(e.target.id === 'lightbox') {
        document.getElementById('lightbox').style.display = 'none';
    }
});

setupDropZone('image-drop-zone', 'image-input', 'image-container', 'image');
setupDropZone('pdf-drop-zone', 'pdf-input', 'pdf-container', 'pdf');

document.getElementById('reset-all-images').addEventListener('click', ()=>resetAllFiles('#image-container', 'image-buttons', 'image'));
document.getElementById('reset-all-pdfs').addEventListener('click', ()=>resetAllFiles('#pdf-container', 'pdf-buttons', 'pdf'));
</script>

</body>
</html